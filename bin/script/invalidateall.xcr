use base qw(core);
use File::Spec;
use xcropt;

my $Inventory_Path = $xcropt::options{inventory_path};
my $Logfile = File::Spec->catfile($Inventory_Path, 'transitions.log');

my @jobs;
open (my $LOG, '<', $Logfile);
unless ($LOG) {
    warn "Failed to open the log file $Logfile in read mode.";
}
my @ids;
while (<$LOG>) {
    chomp;
    if ($_ =~ /^:reqID\s+(\S+)/ ) {
	my $id = $1;
	push(@ids, $1);
    }
}
system("$ENV{XCRYPT}/bin/xcryptinvalidate @ids");
close ($LOG);
